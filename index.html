<!DOCTYPE html>
<html lang="tr">
<head>
<style>
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* YENÄ° SÄ°STEM Ä°Ã‡Ä°N EK CSS (HÄ°Ã‡BÄ°R ÅEYÄ° SÄ°LMEZ) */
.add-btn-fixed {
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 65px;
    height: 65px;
    background: linear-gradient(135deg, #ff5e57, #e14b48);
    color: white;
    border: none;
    border-radius: 50%;
    font-size: 32px;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    z-index: 2000;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.3s;
}
.add-btn-fixed:hover { transform: scale(1.1) rotate(90deg); }

.modal-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.7);
    backdrop-filter: blur(8px);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 3000;
}
.modal-form {
    background: white;
    padding: 25px;
    border-radius: 20px;
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    font-family: 'Segoe UI', sans-serif;
    animation: fadeInUp 0.4s ease;
}
.modal-form input, .modal-form select, .modal-form textarea {
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    border: 1px solid #ddd;
    border-radius: 10px;
    box-sizing: border-box;
}
#miniMap { height: 200px; border-radius: 12px; margin: 10px 0; border: 1px solid #eee; }
.save-btn {
    background: #27ae60;
    color: white;
    border: none;
    padding: 15px;
    width: 100%;
    border-radius: 10px;
    font-weight: bold;
    cursor: pointer;
    font-size: 16px;
}

/* KALÄ°TELÄ° ARAMA Ã–NERÄ°LERÄ° STÄ°LÄ° */
#suggestions {
    position: absolute;
    top: 45px;
    left: 0;
    width: 100%;
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    z-index: 2000;
    max-height: 250px;
    overflow-y: auto;
    display: none;
}
.suggestion-item {
    padding: 10px 15px;
    cursor: pointer;
    border-bottom: 1px solid #eee;
    font-size: 13px;
    color: #333;
}
.suggestion-item:hover { background: #f0f4ff; }
</style>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rotist - Rota PlanlayÄ±cÄ±</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Delius+Swash+Caps&display=swap" rel="stylesheet">
</head>
<body style="margin:0; padding:0;">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Delius+Swash+Caps&display=swap" rel="stylesheet">

<nav class="navbar" style="display: flex; align-items: center; justify-content: space-between; background: #fff; padding: 12px 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); font-family: 'Segoe UI', sans-serif; flex-wrap: wrap; gap: 10px;">
  <div class="logo" style="display: flex; align-items: center; gap: 10px; font-weight: bold; font-size: 20px; color: #2c3e50;">
    <img src="https://i.hizliresim.com/1z3nuak.png" alt="Rotist Logo" style="height: 60px;" />
<span style="font-family: 'Delius Swash Caps', cursive; font-weight: 400; font-style: normal;">Rotist</span>
  </div>

  <ul class="menu" style="display: flex; align-items: center; flex-wrap: wrap; gap: 20px; list-style: none; margin: 0; padding: 0;">
    
    <li class="search-area" style="display: flex; align-items: center; gap: 10px; position: relative;">
<input 
  type="text" 
  id="addressInput" 
  placeholder="Nereden baÅŸlayacaksÄ±n?" 
  oninput="searchAddress()" 
  style="
    padding: 10px 14px; 
    border: 1px solid #ccc; 
    border-radius: 8px; 
    width: 220px; 
    font-size: 14px; 
    transition: box-shadow 0.3s, border-color 0.3s;
    outline: none;
  "
  onfocus="this.style.borderColor='#3498db'; this.style.boxShadow='0 0 8px rgba(52,152,219,0.4)'"
  onblur="setTimeout(() => { document.getElementById('suggestions').style.display='none' }, 200)"
/>
      <div id="suggestions"></div>
      <button onclick="useGeolocation()" style="padding: 6px 10px; background-color: #3498db; color: white; border: none; border-radius: 6px; cursor: pointer;">Konum</button>
    </li>

    <li class="dropdown" style="position: relative;">
      <button onclick="toggleCategoryMenu()" style="padding: 6px 10px; background-color: #ecf0f1; border: 1px solid #ccc; border-radius: 6px; cursor: pointer;">ğŸ“‚ Kategoriler</button>
    <div id="categoryMenu"
     style="display: none; position: absolute; top: 48px; left: 0; background: #ffffff; border: 1px solid #ccc; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.12); padding: 16px 18px; z-index: 999; max-height: 320px; overflow-y: auto; min-width: 220px; color: #000; font-family: 'Segoe UI', sans-serif; font-size: 15px;">
  
  <style>
    #categoryMenu label {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      padding: 8px 10px;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.2s;
    }

    #categoryMenu label:hover {
      background-color: #f0f8ff;
      transform: translateX(2px);
    }

    #categoryMenu input[type="checkbox"] {
      accent-color: #007BFF;
      width: 16px;
      height: 16px;
      cursor: pointer;
    }

    #categoryMenu input[type="checkbox"]:checked + span {
      background-color: #e0f0ff;
      padding: 4px 6px;
      border-radius: 6px;
      font-weight: bold;
    }
  </style>

  <label><input type="checkbox" value="tarihi" onchange="highlightSelected(this)" /><span>Tarihi Yerler</span></label>
  <label><input type="checkbox" value="muze" onchange="highlightSelected(this)" /><span>MÃ¼zeler</span></label>
  <label><input type="checkbox" value="dini" onchange="highlightSelected(this)" /><span>Dini YapÄ±lar</span></label>
  <label><input type="checkbox" value="manzara" onchange="highlightSelected(this)" /><span>Manzara BÃ¶lgeleri</span></label>
  <label><input type="checkbox" value="kafe" onchange="highlightSelected(this)" /><span>Kafeler</span></label>
  <label><input type="checkbox" value="galeri" onchange="highlightSelected(this)" /><span>Sanat Galerileri</span></label>
  <label><input type="checkbox" value="stadyum" onchange="highlightSelected(this)" /><span>Stadyumlar</span></label>
  <label><input type="checkbox" value="park" onchange="highlightSelected(this)" /><span>Parklar</span></label>
  <label><input type="checkbox" value="meydan" onchange="highlightSelected(this)" /><span>Meydanlar</span></label>
  <label><input type="checkbox" value="cadde" onchange="highlightSelected(this)" /><span>ÃœnlÃ¼ Caddeler</span></label>
</div>

<script>
  function highlightSelected(checkbox) {
    const label = checkbox.closest('label');
    if (checkbox.checked) {
      label.style.backgroundColor = '#d9efff';
      label.style.fontWeight = 'bold';
    } else {
      label.style.backgroundColor = '';
      label.style.fontWeight = '';
    }
  }
</script>

    </li>

    <li class="range-area" style="display: flex; align-items: center; gap: 12px; padding: 10px 14px; background: #f0f4ff; border-radius: 8px; box-shadow: inset 0 1px 3px rgba(0,0,0,0.08); font-family: 'Segoe UI', sans-serif; color: #2c3e50;">
  <label for="placeCount" style="font-weight: 500; white-space: nowrap;">
    ğŸ—ºï¸ KaÃ§ yeri gezmek istiyorsun?
  </label>
  <input type="range" id="placeCount" min="1" max="25" value="5"
         oninput="document.getElementById('placeCountLabel').textContent = this.value"
         style="width: 140px; accent-color: #3498db; cursor: pointer;" />
  <span id="placeCountLabel" style="background: #3498db; color: white; font-weight: bold; padding: 2px 8px; border-radius: 6px; min-width: 26px; text-align: center;">
    5
  </span>
</li>


    <li style="list-style: none; margin-top: 10px;">
  <button 
    onclick="createRoute()" 
    style="
      padding: 10px 18px;
      background: linear-gradient(135deg, #27ae60, #2ecc71);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      transition: background 0.3s, transform 0.2s, box-shadow 0.2s;
    "
    onmouseover="this.style.background='linear-gradient(135deg, #2ecc71, #27ae60)'; this.style.transform='scale(1.03)'"
    onmouseout="this.style.background='linear-gradient(135deg, #27ae60, #2ecc71)'; this.style.transform='scale(1)'"
  >
     RotayÄ± OluÅŸtur
  </button>
</li>

</nav>

<script>

  function toggleCategoryMenu() {
    const menu = document.getElementById("categoryMenu");
    menu.style.display = menu.style.display === "block" ? "none" : "block";
  }

  const rangeInput = document.getElementById("placeCount");
  const rangeLabel = document.getElementById("placeCountLabel");

  rangeInput.addEventListener("input", () => {
    rangeLabel.textContent = rangeInput.value;
  });
</script>

  <div id="map" style="height: calc(100vh - 85px); width: 100%; position: relative;">
  <div id="categoryLegend" style="
  position: absolute;
  top: 10px;
  right: 10px;
  background: rgba(255, 255, 255, 0.8);
  padding: 12px 16px;
  border-radius: 12px;
  font-family: 'Segoe UI', sans-serif;
  font-size: 14px;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);
  z-index: 1000;
  max-width: 220px;
  backdrop-filter: blur(6px);
">
  <strong style="font-size: 15px; display: block; margin-bottom: 6px;">ğŸ¨ Kategori Renkleri</strong>
  <ul style="list-style: none; padding: 0; margin: 0;">
    <li><span style="display:inline-block;width:14px;height:14px;background:#e74c3c;border-radius:3px;margin-right:6px;"></span> Tarihi Yerler</li>
    <li><span style="display:inline-block;width:14px;height:14px;background:#8e44ad;border-radius:3px;margin-right:6px;"></span> MÃ¼zeler</li>
    <li><span style="display:inline-block;width:14px;height:14px;background:#2ecc71;border-radius:3px;margin-right:6px;"></span> Dini YapÄ±lar</li>
    <li><span style="display:inline-block;width:14px;height:14px;background:#3498db;border-radius:3px;margin-right:6px;"></span> Manzara BÃ¶lgeleri</li>
    <li><span style="display:inline-block;width:14px;height:14px;background:#f39c12;border-radius:3px;margin-right:6px;"></span> Kafeler</li>
    <li><span style="display:inline-block;width:14px;height:14px;background:#1abc9c;border-radius:3px;margin-right:6px;"></span> Sanat Galerileri</li>
    <li><span style="display:inline-block;width:14px;height:14px;background:#c0392b;border-radius:3px;margin-right:6px;"></span> Stadyumlar</li>
    <li><span style="display:inline-block;width:14px;height:14px;background:#27ae60;border-radius:3px;margin-right:6px;"></span> Parklar</li>
    <li><span style="display:inline-block;width:14px;height:14px;background:#e67e22;border-radius:3px;margin-right:6px;"></span> Meydanlar</li>
    <li><span style="display:inline-block;width:14px;height:14px;background:#9b59b6;border-radius:3px;margin-right:6px;"></span> ÃœnlÃ¼ Caddeler</li>
  </ul>
</div>

  
  
  
<div id="routeInstructions" style="
  display: none;
  position: absolute;
  bottom: 30px;
  left: 20px;
  right: 20px;
  max-width: 420px;
  z-index: 1000;
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.4), rgba(240, 240, 255, 0.2));
  padding: 20px 24px;
  border-radius: 16px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
  font-family: 'Segoe UI', sans-serif;
  font-size: 15px;
  line-height: 1.6;
  overflow: hidden;
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: 1px solid rgba(255, 255, 255, 0.4);
  color: #222;
  animation: fadeInUp 0.5s ease;
  transition: all 0.3s ease-in-out;
">
  <div style="
    font-weight: 600;
    font-size: 17px;
    margin-bottom: 10px;
    color: #222;
    border-left: 4px solid #007bff;
    padding-left: 10px;
    display: flex;
    align-items: center;
    gap: 6px;
  ">
    <span>ğŸ§­</span> Yol Tarifi
  </div>

  <ol id="instructionList" style="
    margin: 0;
    padding-left: 20px;
    max-height: 280px;
    overflow-y: auto;
    list-style-position: inside;
    scrollbar-width: thin;
    scrollbar-color: #999 #f0f0f0;
  "></ol>
</div>

  </div>

  <button class="add-btn-fixed" onclick="openPlaceModal()">+</button>

  <div class="modal-overlay" id="placeModal">
      <div class="modal-form">
          <h2 style="margin-top:0; color:#2c3e50; border-bottom:2px solid #eee; padding-bottom:10px;">ğŸ“ Yeni Yer Kaydet</h2>
          
          <label style="font-weight:bold; font-size:14px;">Mekan AdÄ±</label>
          <input type="text" id="newPlaceName" placeholder="Ã–rn: Galata Kulesi">

          <label style="font-weight:bold; font-size:14px;">Konum Bul / Haritadan SeÃ§</label>
          <input type="text" id="newPlaceSearch" placeholder="Yer ismi veya adres arayÄ±n..." onchange="formSearch()">
          <div id="miniMap"></div>
          <p style="font-size:12px; color:#666; margin:0;">* Haritaya tÄ±klayarak iÅŸaretÃ§iyi koyabilirsiniz.</p>

          <label style="font-weight:bold; font-size:14px; display:block; margin-top:10px;">Kategori</label>
          <select id="newPlaceCat">
              <option value="tarihi">Tarihi Yerler</option>
              <option value="muze">MÃ¼zeler</option>
              <option value="kafe">Kafeler</option>
              <option value="park">Parklar</option>
          </select>

          <label style="font-weight:bold; font-size:14px;">Ziyaret Notu</label>
          <textarea id="newPlaceNote" rows="2" placeholder="KÄ±sa bir aÃ§Ä±klama ekleyin..."></textarea>

          <div style="display:flex; gap:10px; margin-top:15px;">
              <button onclick="closePlaceModal()" style="flex:1; padding:12px; border:none; border-radius:10px; cursor:pointer;">Ä°ptal</button>
              <button class="save-btn" style="flex:2;" onclick="savePlaceData()">Kaydet ve Haritaya Ekle</button>
          </div>
      </div>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    /* ANA HARÄ°TA KURULUMU */
    var mainMap = L.map('map').setView([41.0082, 28.9784], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
    }).addTo(mainMap);

    var startMarker = null;
    var miniMap, miniMarker;

    /* 1. GELÄ°ÅMÄ°Å OTOMATÄ°K TAMAMLAMALI ARAMA (KALÄ°TELÄ°) */
    async function searchAddress() {
        const input = document.getElementById('addressInput');
        const box = document.getElementById('suggestions');
        const query = input.value;

        if (query.length < 3) {
            box.style.display = 'none';
            return;
        }

        try {
            const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${query}&limit=5&addressdetails=1`);
            const data = await res.json();

            box.innerHTML = '';
            if (data.length > 0) {
                box.style.display = 'block';
                data.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'suggestion-item';
                    div.innerText = item.display_name;
                    div.onclick = () => {
                        const loc = [item.lat, item.lon];
                        setStartMarker(loc, item.display_name);
                        input.value = item.display_name;
                        box.style.display = 'none';
                    };
                    box.appendChild(div);
                });
            }
        } catch (err) { console.error("Arama hatasÄ±:", err); }
    }

    function setStartMarker(loc, label) {
        mainMap.setView(loc, 15);
        if (startMarker) mainMap.removeLayer(startMarker);
        startMarker = L.marker(loc).addTo(mainMap)
            .bindPopup(`<b>BaÅŸlangÄ±Ã§:</b><br>${label}`).openPopup();
    }

    /* 2. SAÄ TIK (PC) & BASILI TUTMA (MOBÄ°L) ETKÄ°LEÅÄ°MÄ° */
    // SaÄŸ TÄ±k
    mainMap.on('contextmenu', function(e) {
        setStartMarker(e.latlng, "Haritadan seÃ§ilen nokta");
    });

    // Mobilde BasÄ±lÄ± Tutma (SimÃ¼le)
    let pressTimer;
    mainMap.on('mousedown touchstart', function(e) {
        pressTimer = window.setTimeout(function() {
            setStartMarker(e.latlng, "BasÄ±lÄ± tutarak seÃ§ilen nokta");
        }, 800);
    });
    mainMap.on('mouseup touchend mousemove touchmove', function() {
        clearTimeout(pressTimer);
    });

    /* FORM VE MODAL FONKSÄ°YONLARI */
    function openPlaceModal() {
        document.getElementById('placeModal').style.display = 'flex';
        if (!miniMap) {
            setTimeout(() => {
                miniMap = L.map('miniMap').setView([41.0082, 28.9784], 12);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(miniMap);
                miniMap.on('click', function(e) {
                    if (miniMarker) miniMap.removeLayer(miniMarker);
                    miniMarker = L.marker(e.latlng).addTo(miniMap);
                });
            }, 300);
        }
    }

    function closePlaceModal() {
        document.getElementById('placeModal').style.display = 'none';
    }

    async function formSearch() {
        let val = document.getElementById('newPlaceSearch').value;
        if (val.length < 3) return;
        let res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${val}, Istanbul`);
        let data = await res.json();
        if (data.length > 0) {
            let loc = [data[0].lat, data[0].lon];
            miniMap.setView(loc, 15);
            if (miniMarker) miniMap.removeLayer(miniMarker);
            miniMarker = L.marker(loc).addTo(miniMap);
        }
    }

    function savePlaceData() {
        let name = document.getElementById('newPlaceName').value;
        let cat = document.getElementById('newPlaceCat').value;
        if (!name || !miniMarker) { alert("LÃ¼tfen isim ve konum seÃ§in!"); return; }
        
        L.marker(miniMarker.getLatLng()).addTo(mainMap)
            .bindPopup(`<b>${name}</b><br>Kategori: ${cat}`)
            .openPopup();
        
        alert("BaÅŸarÄ±yla eklendi!");
        closePlaceModal();
    }

    function useGeolocation() {
        mainMap.locate({setView: true, maxZoom: 16});
        mainMap.on('locationfound', (e) => setStartMarker(e.latlng, "Mevcut Konumun"));
    }

    function createRoute() { 
        document.getElementById('routeInstructions').style.display = 'block'; 
    }
  </script>
</body>
</html>
