<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rotist - Profesyonel Rota PlanlayÄ±cÄ±</title>
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Delius+Swash+Caps&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  
  <style>
    /* Global Stiller */
    * { box-sizing: border-box; transition: all 0.2s ease; }
    body, html { margin: 0; padding: 0; height: 100%; font-family: 'Poppins', sans-serif; background: #f4f7f6; overflow: hidden; }
    
    /* Layout */
    .app-container { display: flex; flex-direction: column; height: 100vh; }
    #map { flex-grow: 1; width: 100%; z-index: 1; }

    /* Navbar */
    .navbar {
      display: flex; align-items: center; justify-content: space-between;
      background: #fff; padding: 10px 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      z-index: 1001; position: relative;
    }
    .logo-area { display: flex; align-items: center; gap: 12px; }
    .logo-text { font-family: 'Delius Swash Caps', cursive; font-size: 24px; color: #2c3e50; }

    /* ArtÄ± Butonu */
    .add-trigger-btn {
      position: fixed; bottom: 30px; right: 30px;
      width: 65px; height: 65px; background: linear-gradient(135deg, #ff5e57, #e14b48);
      color: white; border: none; border-radius: 50%; font-size: 32px;
      cursor: pointer; box-shadow: 0 6px 20px rgba(225, 75, 72, 0.4);
      z-index: 2000; display: flex; align-items: center; justify-content: center;
    }
    .add-trigger-btn:hover { transform: scale(1.1) rotate(90deg); }

    /* Form ModalÄ± */
    .modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.7); backdrop-filter: blur(8px);
      display: none; justify-content: center; align-items: center; z-index: 3000;
    }
    .modal-content {
      background: white; border-radius: 24px; width: 95%; max-width: 600px;
      max-height: 90vh; overflow-y: auto; padding: 30px; position: relative;
      box-shadow: 0 25px 50px rgba(0,0,0,0.3);
    }

    /* Web Form ElemanlarÄ± */
    .form-group { margin-bottom: 18px; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #444; font-size: 14px; }
    .form-control {
      width: 100%; padding: 12px 15px; border: 2px solid #eee;
      border-radius: 12px; font-family: inherit; font-size: 14px; outline: none;
    }
    .form-control:focus { border-color: #3498db; background: #f9fbff; }
    
    #miniMap { height: 220px; border-radius: 15px; margin: 10px 0; border: 2px solid #eee; }

    .btn-row { display: flex; gap: 10px; margin-top: 25px; }
    .btn {
      flex: 1; padding: 14px; border: none; border-radius: 12px;
      font-weight: 600; cursor: pointer; font-size: 15px;
    }
    .btn-save { background: #27ae60; color: white; }
    .btn-save:hover { background: #219150; box-shadow: 0 4px 12px rgba(39,174,96,0.3); }
    .btn-cancel { background: #f1f2f6; color: #57606f; }

    /* SaÄŸ Ãœst Legend */
    .map-overlay-card {
      position: absolute; top: 20px; right: 20px; background: white;
      padding: 15px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      z-index: 1000; font-size: 13px; width: 180px;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(50px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .modal-active { display: flex; animation: slideUp 0.4s ease-out; }
  </style>
</head>
<body>

<div class="app-container">
  <nav class="navbar">
    <div class="logo-area">
      <img src="https://i.hizliresim.com/1z3nuak.png" alt="Logo" style="height: 50px;">
      <span class="logo-text">Rotist</span>
    </div>
    
    <div style="display: flex; gap: 15px;">
        <input type="text" id="mainSearch" placeholder="Haritada yer ara..." class="form-control" style="width: 250px; padding: 8px 15px;">
        <button onclick="createRoute()" class="btn-save" style="padding: 0 20px; border-radius: 8px; border:none; color:white; cursor:pointer;">RotayÄ± Ã‡iz</button>
    </div>
  </nav>

  <div id="map">
    <div class="map-overlay-card">
      <strong style="display:block; margin-bottom:8px;">ğŸ“ Yer Kategorileri</strong>
      <div style="display:flex; align-items:center; gap:8px; margin-bottom:5px;">
        <span style="width:12px; height:12px; background:#e74c3c; border-radius:3px;"></span> Tarihi
      </div>
      <div style="display:flex; align-items:center; gap:8px; margin-bottom:5px;">
        <span style="width:12px; height:12px; background:#f39c12; border-radius:3px;"></span> Kafe/Restoran
      </div>
      <div style="display:flex; align-items:center; gap:8px;">
        <span style="width:12px; height:12px; background:#2ecc71; border-radius:3px;"></span> DoÄŸa/Park
      </div>
    </div>
  </div>
</div>

<button class="add-trigger-btn" onclick="toggleModal(true)">+</button>

<div class="modal-overlay" id="formModal">
  <div class="modal-content">
    <h2 style="margin-top:0; color:#2c3e50;">âœ¨ Yeni Mekan KaydÄ±</h2>
    <p style="color:#7f8c8d; font-size:14px;">MekanÄ± haritadan seÃ§in ve bilgilerini doldurun.</p>

    <div class="form-group">
      <label>Mekan AdÄ±</label>
      <input type="text" id="placeName" class="form-control" placeholder="Ã–rn: Galata Kahvecisi">
    </div>

    <div class="form-group">
      <label>Harita Ãœzerinde Konum (TÄ±kla veya Ara)</label>
      <input type="text" id="miniSearch" class="form-control" placeholder="Adres veya mekan ara..." onchange="searchLocation()">
      <div id="miniMap"></div>
      <small style="color:#95a5a6;">* Haritaya tÄ±klayarak kÄ±rmÄ±zÄ± iÅŸaretÃ§iyi hareket ettirebilirsiniz.</small>
    </div>

    <div class="form-group">
      <label>Kategori</label>
      <select id="placeCategory" class="form-control">
        <option value="tarihi">ğŸ›ï¸ Tarihi YapÄ±</option>
        <option value="kafe">â˜• Kafe & Restoran</option>
        <option value="doga">ğŸŒ³ DoÄŸa & Park</option>
        <option value="muze">ğŸ¨ MÃ¼ze & Sanat</option>
      </select>
    </div>

    <div class="form-group">
      <label>Ziyaret Notu / AÃ§Ä±klama</label>
      <textarea id="placeDesc" class="form-control" rows="3" placeholder="Buraya gidince ne yapmalÄ±?"></textarea>
    </div>

    <div class="btn-row">
      <button class="btn btn-cancel" onclick="toggleModal(false)">VazgeÃ§</button>
      <button class="btn btn-save" onclick="saveData()">Sisteme Kaydet</button>
    </div>
  </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  let mainMap, miniMap, miniMarker;
  let savedPlaces = [];

  // HaritalarÄ± BaÅŸlat
  window.onload = () => {
    mainMap = L.map('map').setView([41.0082, 28.9784], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(mainMap);
  };

  // Modal AÃ§/Kapat
  function toggleModal(show) {
    const modal = document.getElementById('formModal');
    if (show) {
      modal.classList.add('modal-active');
      initMiniMap();
    } else {
      modal.classList.remove('modal-active');
    }
  }

  // Mini Harita Fonksiyonu
  function initMiniMap() {
    if (!miniMap) {
      setTimeout(() => {
        miniMap = L.map('miniMap').setView([41.0082, 28.9784], 11);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(miniMap);
        
        miniMap.on('click', (e) => {
          updateMiniMarker(e.latlng);
        });
      }, 200);
    }
  }

  function updateMiniMarker(latlng) {
    if (miniMarker) miniMap.removeLayer(miniMarker);
    miniMarker = L.marker(latlng, {draggable: true}).addTo(miniMap);
  }

  // Yer Arama (API)
  async function searchLocation() {
    const query = document.getElementById('miniSearch').value;
    if(query.length < 3) return;
    
    const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${query}, Istanbul`);
    const data = await res.json();
    
    if(data.length > 0) {
      const loc = [data[0].lat, data[0].lon];
      miniMap.setView(loc, 15);
      updateMiniMarker(loc);
    }
  }

  // VERÄ° KAYDETME (AsÄ±l Web Form Ä°ÅŸlemi)
  function saveData() {
    const name = document.getElementById('placeName').value;
    const cat = document.getElementById('placeCategory').value;
    const desc = document.getElementById('placeDesc').value;
    
    if(!name || !miniMarker) {
      alert("LÃ¼tfen mekan adÄ±nÄ± girin ve haritadan konum seÃ§in!");
      return;
    }

    const latlng = miniMarker.getLatLng();
    const newData = { name, cat, desc, latlng };
    
    // Veriyi diziye ekle
    savedPlaces.push(newData);

    // Ana Haritaya Ekle
    const markerColor = cat === 'tarihi' ? '#e74c3c' : (cat === 'kafe' ? '#f39c12' : '#2ecc71');
    
    L.circleMarker(latlng, {
      radius: 10,
      fillColor: markerColor,
      color: "#fff",
      weight: 2,
      opacity: 1,
      fillOpacity: 0.8
    }).addTo(mainMap)
      .bindPopup(`<b>${name}</b><br><i>${cat.toUpperCase()}</i><br>${desc}`)
      .openPopup();

    // Formu temizle ve kapat
    document.getElementById('placeName').value = '';
    document.getElementById('placeDesc').value = '';
    toggleModal(false);
    
    console.log("Kaydedilen Veriler:", savedPlaces);
    alert("Mekan baÅŸarÄ±yla veri tabanÄ±na (simÃ¼le) eklendi!");
  }

  function createRoute() {
    if(savedPlaces.length < 2) {
        alert("Rota oluÅŸturmak iÃ§in en az 2 mekan eklemelisiniz!");
        return;
    }
    alert("EklediÄŸiniz " + savedPlaces.length + " nokta arasÄ±nda en kÄ±sa rota hesaplanÄ±yor...");
  }
</script>

</body>
</html>
